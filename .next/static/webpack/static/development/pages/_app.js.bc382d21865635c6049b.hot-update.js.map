{"version":3,"file":"static/webpack/static/development/pages/_app.js.bc382d21865635c6049b.hot-update.js","sources":["webpack:///./components/TakeMyMoneyPaystack.js","webpack:///./node_modules/react-paystack/distribution/paystack.min.js"],"sourcesContent":["import React from \"react\";\nimport StripeCheckout from \"react-stripe-checkout\";\nimport PaystackButton from 'react-paystack';\nimport { Mutation } from \"react-apollo\";\nimport Router from \"next/router\";\nimport NProgress from \"nprogress\";\nimport PropTypes from \"prop-types\";\nimport gql from \"graphql-tag\";\nimport styled from \"styled-components\"\nimport calcTotalPrice from \"../lib/calcTotalPrice\";\nimport Error from \"./ErrorMessage\";\nimport User, { CURRENT_USER_QUERY } from \"./User\";\n\nconst Pay = styled.div`\n.payButton {\n  background: #3d7bc9;\n  color: white;\n  font-weight: 500;\n  border: 0;\n  border-radius: 0;\n  text-transform: uppercase;\n  font-size: 2rem;\n  padding: 0.8rem 1.5rem;\n  transform: skew(-2deg);\n  display: inline-block;\n  transition: all 0.5s;\n  &[disabled] {\n    opacity: 0.5;\n}\n}\n`\n\nconst CREATE_ORDER_MUTATION = gql`\n  mutation CREATE_ORDER_MUTATION($token: String!) {\n    createOrder(token: $token) {\n      id\n      charge\n      total\n      items {\n        id\n        title\n      }\n    }\n  }\n`;\n\nfunction totalItems(cart) {\n  return cart.reduce((tally, cartItem) => tally + cartItem.quantity, 0);\n}\n\nclass TakeMyMoneyPaystack extends React.Component {\n  onTokenResponse = async (res, createOrder) => {\n    NProgress.start();\n    console.log(\"Ontoken paystack called\", res);\n    //manually call the mutation once we have the stripe token\n    const order = await createOrder({\n      variables: {\n        token: res.id\n      }\n    }).catch(err => {\n      alert(err.message);\n    });\n    console.log({ order });\n    Router.push({\n      pathname: \"/order\",\n      query: { id: order.data.createOrder.id }\n    });\n  };\n  close = () => {\n    console.log(\"Payment closed\");\n  }\n  render() {\n    const { children } = this.props;\n    return (\n      <User>\n        {({ data: { me } }) => (\n          <Mutation\n            mutation={CREATE_ORDER_MUTATION}\n            refetchQueries={[\n              {\n                query: CURRENT_USER_QUERY\n              }\n            ]}\n          >\n            {createOrder => (\n              <Pay>\n                <PaystackButton\n                text=\"Make Payment\"\n                className=\"payButton\"\n                callback={res => this.onTokenResponse(res, createOrder)}\n                close={this.close}\n                disabled={false}\n                embed={true}\n                email={me.email}\n                amount={calcTotalPrice(me.cart)}\n                paystackkey=\"pk_test_cd998cf8585ed603d6ba32e8f9e76e8cb0430c18\"\n                tag=\"button\"\n              />\n              </Pay>\n            )}\n          </Mutation>\n        )}\n      </User>\n    );\n  }\n}\n\nexport default TakeMyMoneyPaystack;\n","\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; };\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _react = require(\"react\");\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _propTypes = require(\"prop-types\");\n\nvar _propTypes2 = _interopRequireDefault(_propTypes);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar PayStack = function (_Component) {\n  _inherits(PayStack, _Component);\n\n  function PayStack(props) {\n    _classCallCheck(this, PayStack);\n\n    var _this = _possibleConstructorReturn(this, (PayStack.__proto__ || Object.getPrototypeOf(PayStack)).call(this, props));\n\n    _this.payWithPaystack = _this.payWithPaystack.bind(_this);\n    _this.loadScript = _this.loadScript.bind(_this);\n    _this.loadscriptAndUpdateState = _this.loadscriptAndUpdateState.bind(_this);\n    _this.state = _extends({}, _this.props, {\n      scriptLoaded: null,\n      class: _this.props.class || _this.props.className || \"\"\n    });\n    return _this;\n  }\n\n  _createClass(PayStack, [{\n    key: \"componentDidMount\",\n    value: function componentDidMount() {\n      this.loadscriptAndUpdateState();\n    }\n  }, {\n    key: \"loadscriptAndUpdateState\",\n    value: function loadscriptAndUpdateState() {\n      var _this2 = this;\n\n      this.setState({\n        scriptLoaded: new Promise(function (resolve) {\n          _this2.loadScript(function () {\n            resolve();\n          });\n        })\n      }, function () {\n        if (_this2.props.embed) {\n          _this2.payWithPaystack();\n        }\n      });\n    }\n  }, {\n    key: \"loadScript\",\n    value: function loadScript(callback) {\n      var script = document.createElement(\"script\");\n      script.src = \"https://js.paystack.co/v1/inline.js\";\n      document.getElementsByTagName(\"head\")[0].appendChild(script);\n      if (script.readyState) {\n        // IE\n        script.onreadystatechange = function () {\n          if (script.readyState === \"loaded\" || script.readyState === \"complete\") {\n            script.onreadystatechange = null;\n            callback();\n          }\n        };\n      } else {\n        // Others\n        script.onload = function () {\n          callback();\n        };\n      }\n    }\n  }, {\n    key: \"componentDidUpdate\",\n    value: function componentDidUpdate(prevProps, prevState) {\n      for (var index in prevProps) {\n        if (prevState[index] !== this.state[index]) {\n          this.loadscriptAndUpdateState();\n        }\n      }\n    }\n  }, {\n    key: \"payWithPaystack\",\n    value: function payWithPaystack() {\n      var _this3 = this;\n\n      this.state.scriptLoaded && this.state.scriptLoaded.then(function () {\n        console.log('ref:', _this3.state.reference);\n        var paystackOptions = {\n          key: _this3.state.paystackkey,\n          email: _this3.state.email,\n          amount: _this3.state.amount,\n          ref: _this3.state.reference,\n          metadata: _this3.state.metadata || {},\n          callback: function callback(response) {\n            _this3.state.callback(response);\n          },\n          onClose: function onClose() {\n            _this3.state.close();\n          },\n          currency: _this3.state.currency,\n          plan: _this3.state.plan || \"\",\n          quantity: _this3.state.quantity || \"\",\n          subaccount: _this3.state.subaccount || \"\",\n          transaction_charge: _this3.state.transaction_charge || 0,\n          bearer: _this3.state.bearer || \"\"\n        };\n        if (_this3.state.embed) {\n          paystackOptions.container = \"paystackEmbedContainer\";\n        }\n        var handler = window.PaystackPop.setup(paystackOptions);\n        if (!_this3.state.embed) {\n          handler.openIframe();\n        }\n      });\n    }\n  }, {\n    key: \"render\",\n    value: function render() {\n      var CustomTag = \"\" + this.props.tag;\n      return this.props.embed ? _react2.default.createElement(\"div\", { id: \"paystackEmbedContainer\" }) : _react2.default.createElement(\n        _react.Fragment,\n        null,\n        _react2.default.createElement(\n          CustomTag,\n          {\n            className: this.state.class,\n            onClick: this.payWithPaystack,\n            disabled: this.state.disabled\n          },\n          this.state.text\n        )\n      );\n    }\n  }], [{\n    key: \"getDerivedStateFromProps\",\n    value: function getDerivedStateFromProps(nextProps, prevState) {\n      for (var index in nextProps) {\n        if (nextProps[index] !== prevState[index]) {\n          return _defineProperty({\n            scriptLoaded: null\n          }, index, nextProps[index]);\n        }\n      }\n\n      return null;\n    }\n  }]);\n\n  return PayStack;\n}(_react.Component);\n\nPayStack.propTypes = {\n  embed: _propTypes2.default.bool,\n  text: _propTypes2.default.string,\n  class: _propTypes2.default.string,\n  metadata: _propTypes2.default.object,\n  currency: _propTypes2.default.string,\n  plan: _propTypes2.default.string,\n  quantity: _propTypes2.default.string,\n  subaccount: _propTypes2.default.string,\n  transaction_charge: _propTypes2.default.number,\n  bearer: _propTypes2.default.string,\n  reference: _propTypes2.default.string.isRequired,\n  email: _propTypes2.default.string.isRequired,\n  amount: _propTypes2.default.number.isRequired, //in kobo\n  paystackkey: _propTypes2.default.string.isRequired,\n  callback: _propTypes2.default.func.isRequired,\n  close: _propTypes2.default.func.isRequired,\n  disabled: _propTypes2.default.bool,\n  tag: _propTypes2.default.oneOf(['button', 'a', 'input'])\n};\n\nPayStack.defaultProps = {\n  tag: 'button',\n  text: \"Make Payment\",\n  currency: \"NGN\",\n  disabled: false\n};\n\nexports.default = PayStack;\n\n//# sourceMappingURL=paystack.min.js.map"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAAA;AAmBA;AACA;AAaA;AACA;AAAA;AAAA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAHA;AAAA;AAKA;AACA;AADA;AADA;AAKA;AACA;AACA;AAXA;AAIA;AAOA;AAAA;AAAA;AACA;AACA;AACA;AAAA;AAAA;AAFA;AACA;AAbA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;;;;;;AAgBA;AACA;AACA;AACA;;;;;;AAAA;AAAA;AACA;AADA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAEA;AACA;AAEA;AADA;AAHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AACA;AACA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAVA;AAAA;AAAA;AAAA;AAAA;AAAA;AAFA;AATA;AA6BA;;;;AAtDA;AACA;AAwDA;;;;;;;;;;;;AC3GA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;A","sourceRoot":""}